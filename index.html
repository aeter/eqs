<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Earthquakes</title>
    <link rel="stylesheet" type="text/css" href="vendor/nouislider-11.1.0/nouislider.min.css">
    <style type="text/css">
        .container {
            max-width: 1000px;
            margin: auto;
        }

        body {
            color: #5d5d5d;
            font-family: Helvetica, Arial, sans-serif;
        }

        h1 {
            font-size: 30px;
            margin: auto;
            margin-top: 50px;
        }

        .mapael .map {
            position: relative;
        }

        .mapael .mapTooltip {
            position: absolute;
            background-color: #fff;
            moz-opacity: 0.70;
            opacity: 0.70;
            filter: alpha(opacity=70);
            border-radius: 10px;
            padding: 10px;
            z-index: 1000;
            max-width: 200px;
            display: none;
            color: #343434;
        }

        .mapael .zoomButton {
            background-color: #fff;
            border: 1px solid #ccc;
            color: #000;
            width: 15px;
            height: 15px;
            line-height: 15px;
            text-align: center;
            border-radius: 3px;
            cursor: pointer;
            position: absolute;
            top: 0;
            font-weight: bold;
            left: 10px;

            -webkit-user-select: none;
            -khtml-user-select : none;
            -moz-user-select: none;
            -o-user-select : none;
            user-select: none;
        }

        /* Reset Zoom button first */
        .mapael .zoomReset {
            top: 10px;
        }

        /* Then Zoom In button */
        .mapael .zoomIn {
            top: 30px;
        }

        /* Then Zoom Out button */
        .mapael .zoomOut {
            top: 50px;
        }

.noUi-tooltip {
    display: none;
}
.noUi-active .noUi-tooltip {
    display: block;
}
    </style>
    <script type="text/javascript" src="vendor/jquery-3.1.1/jquery.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="vendor/raphael-2.2.7/raphael.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="vendor/jquery-mapael-2.2.0/jquery.mapael.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="vendor/jquery-mapael-2.2.0/world_countries.js" charset="utf-8"></script>
    <script type="text/javascript" src="vendor/jquery-mousewheel-3.1.13/jquery.mousewheel.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="vendor/nouislider-11.1.0/nouislider.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="vendor/alasql-0.4.9/alasql.min.js" charset="utf-8"></script>
    <script type="text/javascript">
$(document).ready(function () {
    alasql('CREATE TABLE quakes; SELECT * INTO quakes from TSV("data/significant_quakes.tsv")');
    alasql.fn.to_date = function(x) { return new Date(x); } // for comparing dates

    var getElemID = function(elem) {
        return $(elem.node).attr("data-id");
    };

    var maparea = $(".mapcontainer");
    maparea.mapael({
        map: {
            name: "world_countries",
            zoom: {
                enabled: true,
                maxLevel: 50
            },
            defaultArea: {
                tooltip: {
                    content: getElemID
                },
                eventHandlers: {
                    click: function (e, id) {
                        maparea.trigger('zoom', {
                            area: id,
                            areaMargin: 10
                        });
                    }
                }
            }
        }
    });
    var keyboardSlider = document.getElementById('year_slider');
    
    noUiSlider.create(keyboardSlider, {
        start: [-10, 10],
        step: 1,
        connect: true,
        tooltips: true,
        range: {
            'min': -2150,
            '50%': [1860, 1],
            'max': 2018
        },
        pips: {
            mode: 'values',
            values: [-2150, -1500, -1000, -500, 0, 500, 
                     1000, 1500, 1850, 1880, 1900, 1920, 1940,
                     1960, 1980, 2000, 2018],
            density: 1000
        }
    });
    function quake_info(quake) {
        return "Year: " + quake['YEAR'] + "\n" + "Location: " + quake['LOCATION_NAME']; 
    }
    year_slider.noUiSlider.on('end', function() {
        var years = year_slider.noUiSlider.get();
        var quakes = alasql('select * from quakes where YEAR >= __start_year__ and YEAR <= __end_year__'
            .replace('__start_year__', years[0]).replace('__end_year__', years[1]));

        var new_plots = {};
        for (i = 0; i < quakes.length; i++) {
          quakes[i]['latitude'] = quakes[i]['LATITUDE'];
          quakes[i]['longitude'] = quakes[i]['LONGITUDE'];
          quakes[i]['tooltip'] = {content: quake_info(quakes[i])};
          quakes[i]['size'] = 5;
          new_plots[quakes[i]['I_D']] = quakes[i];
        }

        $(".mapcontainer").trigger('update', [{
            mapOptions: {'areas': {}, 'plots': {}}, 
            newPlots: new_plots,
            deletePlotKeys: Object.keys(maparea.data('mapael').plots),
            animDuration: 0 
        }]);
    });
});
    </script>
  </head>
  <body>
    <a href="https://github.com/aeter/eqs/">
        <img style="position: absolute; top: 0; right: 0; border: 0;"
          src="vendor/github/forkme_right_darkblue.png"
          alt="Fork me on GitHub">
    </a>
    <div class="container">
      <h1 title="Information on destructive earthquakes from 2150 B.C. to the
          present that meet at least one of the following criteria: Moderate
          damage (approximately $1 million or more), 10 or more deaths,
          Magnitude 7.5 or greater, Modified Mercalli Intensity X or greater, or
          the earthquake generated a tsunami.">Significant earthquakes</h1>
      <div class="mapcontainer mapael">
        <div class="map">
        </div>
      <div>
    </div>
    <hr>
    Year <div id="year_slider">
    </div>
    <br>
    <br>
    <br>
    <br>
    <a href="http://dx.doi.org/10.7289/V5TD9V7K">Data source</a>
  </body>
</html>
